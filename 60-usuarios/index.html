<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Pruebas - Sistema Q-Flow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body{font-family:'Aptos','Segoe UI',sans-serif;line-height:1.4;margin:0;padding:10px;background:#f5f5f5;font-size:12px}
        .container{max-width:1400px;margin:0 auto;background:white;padding:15px;border-radius:8px;box-shadow:0 0 15px rgba(0,0,0,0.1)}
        .doc-info{background:#f8f9fa;padding:15px;border-radius:6px;margin-bottom:20px;border-left:4px solid #1a237e;display:grid;grid-template-columns:repeat(2,1fr);gap:15px;font-size:12px;color:#666}
        h1{color:#2c3e50;text-align:center;border-bottom:3px solid #3498db;padding-bottom:10px;margin-bottom:20px;font-size:24px}
        .subtitle{text-align:center;color:#7f8c8d;font-style:italic;margin-bottom:25px;font-size:14px}
        h2{color:#34495e;margin-top:20px;margin-bottom:10px;border-left:3px solid #3498db;padding-left:12px;font-size:16px}
        .test-summary{background:linear-gradient(135deg,#2c3e50,#34495e);color:white;padding:12px;border-radius:6px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:center}
        .test-summary h3{margin:0 0 5px 0;font-size:16px}
        .test-summary p{margin:0;font-size:12px}
        .result-badge{background:#c0392b;color:white;padding:15px 20px;border-radius:6px;font-weight:bold;font-size:18px;text-align:center;min-width:80px;height:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
        .results-table{width:100%;border-collapse:collapse;margin:10px 0;font-size:10px}
        .results-table th,.results-table td{border:1px solid #ddd;padding:6px 4px;text-align:center}
        .results-table th{background:linear-gradient(135deg,#3498db,#2980b9);color:white;font-weight:bold}
        .results-table tr:nth-child(even){background:#f9f9f9}
        .pass{background:#2ecc71;color:white;padding:5px 10px;border-radius:15px;font-weight:bold}
        .fail{background:#c0392b;color:white;padding:5px 10px;border-radius:15px;font-weight:bold}
        .metrics-grid{display:grid;grid-template-columns:repeat(4,1fr) 150px;gap:10px;margin:15px 0;align-items:center}
        .metric-card{background:linear-gradient(135deg,#ff6b6b,#ff5252);color:white;padding:10px;border-radius:6px;text-align:center}
        .metric-value{font-size:1.4em;font-weight:bold;margin-bottom:3px}
        .metric-label{font-size:0.8em;opacity:0.9}
        .pie-chart-container{display:flex;flex-direction:column;align-items:center;background:white;padding:10px;border-radius:6px;box-shadow:0 1px 5px rgba(0,0,0,0.1)}
        .pie-chart-title{font-size:10px;font-weight:bold;color:#2c3e50;margin-bottom:5px}
        .chart-container{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:15px 0}
        .chart-box{background:white;padding:10px;border-radius:6px;box-shadow:0 1px 5px rgba(0,0,0,0.1);height:200px}
        .chart-title{text-align:center;color:#2c3e50;margin-bottom:8px;font-weight:bold;font-size:11px}
        .legend{display:flex;justify-content:center;gap:15px;margin:10px 0;flex-wrap:wrap}
        .legend-item{display:flex;align-items:center;gap:5px;font-size:10px}
        .legend-color{width:15px;height:15px;border-radius:2px}
        .nav-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:10px 0;border-bottom:1px solid #e0e0e0}
        .back-btn{background:linear-gradient(135deg,#3498db,#2980b9);color:white;padding:8px 16px;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s ease}
        .back-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(52,152,219,0.3)}
        .page-title{color:#2c3e50;font-size:14px;font-weight:bold;margin:0}
        .pdf-header{display:none;text-align:center;margin-bottom:25px;border-bottom:3px solid #1a237e}
        .pdf-header img{width:90%;max-width:1000px;height:auto;max-height:150px;object-fit:contain;margin:10px auto 15px auto;display:block}
        .arch-info{background:#ecf0f1;padding:12px;border-radius:6px;margin:15px 0;font-size:11px}
        .servers{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:15px 0}
        .server{background:white;padding:15px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
        .server h4{margin-top:0;font-size:13px}
        .server ul{font-size:10px;margin:0;padding-left:15px}
        .note{background:#fff3cd;border:1px solid #ffeaa7;padding:10px;border-radius:6px;margin-top:15px;font-size:11px;color:#856404}
        .critical{background:#ffebee;border:2px solid #f44336;padding:15px;border-radius:6px;margin-top:15px;font-size:12px;color:#c62828}
        .critical h4{color:#d32f2f;margin-top:0}
        @media print{
            .nav-header{display:none!important}
            body{background:white!important;font-size:10px!important;margin:0!important;padding:15px!important}
            .container{box-shadow:none!important;max-width:100%!important;padding:0!important;margin:0!important}
            .chart-box{height:180px!important;page-break-inside:avoid!important;margin-bottom:15px!important}
            .chart-box canvas{max-height:150px!important;max-width:100%!important;width:100%!important;height:auto!important}
            .chart-container{page-break-inside:avoid!important;margin:10px 0!important}
            .pdf-header{display:block!important}
            body{-webkit-print-color-adjust:exact!important;color-adjust:exact!important}
            .result-badge,.fail{background:#c0392b!important;color:white!important}
            .results-table{page-break-inside:avoid!important;font-size:9px!important}
            .arch-info{page-break-inside:avoid!important;margin:10px 0!important}
            .metrics-grid{page-break-inside:avoid!important;margin:10px 0!important}
            h1,h2{page-break-after:avoid!important}
            h3{page-break-after:avoid!important;page-break-inside:avoid!important}
            @page{margin:0.3in;size:A4}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pdf-header">
            <img src="https://github.com/michaelherreraacftech/TESTBBVA002/raw/main/assets/images/header-acfv2.png" alt="ACF Technologies">
        </div>

        <div class="nav-header">
            <button class="back-btn" onclick="goBack()"><span>‚Üê</span><span>Regresar</span></button>
            <div class="page-title">Reporte de Performance - 60 Usuarios Concurrentes (FAIL CR√çTICO)</div>
            <button class="back-btn" onclick="downloadPDF()" style="background:linear-gradient(135deg,#e74c3c,#c0392b)"><span>üìÑ</span><span>Descargar PDF</span></button>
        </div>

        <div class="doc-info">
            <div><strong>Fecha:</strong> 3 de Junio, 2025</div>
            <div><strong>Entorno:</strong> QA-DESA</div>
            <div><strong>Cliente:</strong> BBVA Mex</div>
            <div><strong>Script:</strong> TAfterEnq Activo</div>
            <div><strong>Analista:</strong> Michael J Herrera B</div>
            <div><strong>Cargo:</strong> L√≠der de QA</div>
        </div>

        <h1>An√°lisis de Capacidad Sistema Q-Flow - Entorno QA-DESA</h1>
        <p class="subtitle">Evaluaci√≥n Completa de Rendimiento: 60 Usuarios Concurrentes<br><strong>Script TAfterEnq Activo - COLAPSO TOTAL DEL SISTEMA</strong></p>

        <div class="test-summary">
            <div>
                <h3>Prueba TESTBBVA004 - Performance (60 Usuarios Concurrentes)</h3>
                <p><strong>Duraci√≥n:</strong> 10 minutos | <strong>Arquitectura:</strong> Q-Flow + IIS + SQL Server</p>
            </div>
            <div class="result-badge">FAIL</div>
        </div>

        <div class="arch-info">
            <h3>üíª Especificaciones de Infraestructura QA-DESA</h3>
            <div class="servers">
                <div class="server">
                    <h4 style="color:#e74c3c">SQL Server (BBVAMX-UATSQL1)</h4>
                    <ul>
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (2.07 GB Disponible)</li>
                        <li><strong>Virtualizaci√≥n:</strong> Hyper-V Virtual Machine</li>
                    </ul>
                </div>
                <div class="server">
                    <h4 style="color:#27ae60">IIS Server 1 (BBVAMX-UATIIS1)</h4>
                    <ul>
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (3.38 GB Disponible)</li>
                        <li><strong>Rol:</strong> Web Services Q-Flow</li>
                    </ul>
                </div>
                <div class="server">
                    <h4 style="color:#3498db">IIS Server 2 (BBVAMX-UATIIS2)</h4>
                    <ul>
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (4.49 GB Disponible)</li>
                        <li><strong>Rol:</strong> Web Services Q-Flow</li>
                    </ul>
                </div>
            </div>
            <div class="critical">
                <strong>üö® ALERTA CR√çTICA:</strong> Sistema completamente saturado con <strong>Script TAfterEnq Activo</strong>. Colapso total confirmado. Capacidad m√°xima operativa: <strong>36 usuarios concurrentes</strong>.
            </div>
        </div>

        <h2>Resultados Consolidados</h2>
        <table class="results-table">
            <thead>
                <tr><th>Prueba</th><th>Concurrencia</th><th>Duraci√≥n</th><th>Muestras</th><th>Errores</th><th>% Error</th><th>Tiempo Prom (ms)</th><th>Min (ms)</th><th>Max (ms)</th><th>Throughput (TPS)</th><th>Resultado</th></tr>
            </thead>
            <tbody>
                <tr><td><strong>TESTBBVA004</strong></td><td>60 usuarios</td><td>10 min</td><td>18,480</td><td>5,626</td><td>30.50%</td><td>1,340ms</td><td>0</td><td>21083</td><td>32.4</td><td><span class="fail">FAIL</span></td></tr>
            </tbody>
        </table>

        <h2>M√©tricas Clave</h2>
        <div class="metrics-grid">
            <div class="metric-card"><div class="metric-value">32.4</div><div class="metric-label">Transacciones/seg</div></div>
            <div class="metric-card"><div class="metric-value">30.50%</div><div class="metric-label">Tasa de Error</div></div>
            <div class="metric-card"><div class="metric-value">1340ms</div><div class="metric-label">Tiempo Promedio</div></div>
            <div class="metric-card"><div class="metric-value">21083ms</div><div class="metric-label">M√°ximo</div></div>
            <div class="pie-chart-container">
                <div class="pie-chart-title">Resultado</div>
                <canvas id="pieChart" width="100" height="100"></canvas>
            </div>
        </div>

        <h2>Rendimiento de Hardware</h2>
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background:#ff6b6b"></div><span>Memoria</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#f9ca24"></div><span>CPU</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#4ecdc4"></div><span>Disco C:</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#9b59b6"></div><span>Disco N:</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#27ae60"></div><span>Disco G:</span></div>
        </div>

        <h3>CPU y Memoria</h3>
        <div class="chart-container">
            <div class="chart-box"><div class="chart-title">IIS Server 1</div><canvas id="s1cpu"></canvas></div>
            <div class="chart-box"><div class="chart-title">IIS Server 2</div><canvas id="s2cpu"></canvas></div>
            <div class="chart-box"><div class="chart-title">SQL Server</div><canvas id="sqlcpu"></canvas></div>
        </div>

        <h3>Uso de Discos</h3>
        <div class="chart-container">
            <div class="chart-box"><div class="chart-title">IIS Server 1 - Discos</div><canvas id="s1disk"></canvas></div>
            <div class="chart-box"><div class="chart-title">IIS Server 2 - Discos</div><canvas id="s2disk"></canvas></div>
            <div class="chart-box"><div class="chart-title">SQL Server - Discos</div><canvas id="sqldisk"></canvas></div>
        </div>

        <h2>An√°lisis de Rendimiento - COLAPSO TOTAL</h2>
        <div class="arch-info">
            <h4>Observaciones Cr√≠ticas del Colapso:</h4>
            <ul>
                <li><strong>üö® Colapso Total Confirmado:</strong> 60 usuarios generan 30.50% de errores, 10x superior al l√≠mite del 3%</li>
                <li><strong>Degradaci√≥n Extrema:</strong> Throughput colapsa a 32.4 TPS (menor que 48 usuarios)</li>
                <li><strong>Latencia Catastr√≥fica:</strong> Tiempo promedio de 1.34 segundos, m√°ximo de 21 segundos</li>
                <li><strong>SQL Server Colapsado:</strong> CPU sostenido 80-100%, completamente saturado</li>
                <li><strong>Memoria Cr√≠tica:</strong> P√°ginas/seg promedio de 21.5 (cr√≠tico > 20), sistema en swap constante</li>
                <li><strong>IIS Servers Estables:</strong> CPU moderado 15-29%, no son el cuello de botella</li>
                <li><strong>Tiempo de Prueba Extendido:</strong> 10 minutos vs 5 minutos previos, sistema no se recupera</li>
                <li><strong>Patr√≥n de Falla Sostenida:</strong> Errores constantes durante toda la prueba</li>
                <li><strong>Script TAfterEnq L√≠mite Superado:</strong> Punto de quiebre catastr√≥fico</li>
                <li><strong>Recursos Completamente Agotados:</strong> SQL Server opera al 100% de capacidad</li>
                <li><strong>Recuperaci√≥n Imposible:</strong> Sistema no muestra signos de estabilizaci√≥n</li>
                <li><strong>Evidencia de Thrashing:</strong> Actividad de memoria excesiva indica memoria insuficiente</li>
            </ul>
        </div>

        <div class="critical">
            <h4>üìä An√°lisis Comparativo de Escalamiento Completo:</h4>
            <table style="width:100%;border-collapse:collapse;margin:10px 0;font-size:11px">
                <thead>
                    <tr style="background:#d32f2f;color:white">
                        <th style="border:1px solid #ddd;padding:6px">Usuarios</th>
                        <th style="border:1px solid #ddd;padding:6px">TPS</th>
                        <th style="border:1px solid #ddd;padding:6px">Error %</th>
                        <th style="border:1px solid #ddd;padding:6px">Tiempo Prom</th>
                        <th style="border:1px solid #ddd;padding:6px">Estado</th>
                        <th style="border:1px solid #ddd;padding:6px">Fase</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="border:1px solid #ddd;padding:4px;text-align:center">12</td><td style="border:1px solid #ddd;padding:4px;text-align:center">14.6</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">0.31%</td><td style="border:1px solid #ddd;padding:4px;text-align:center">335ms</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">‚úÖ PASS</td><td style="border:1px solid #ddd;padding:4px;text-align:center">√ìptimo</td></tr>
                    <tr><td style="border:1px solid #ddd;padding:4px;text-align:center">24</td><td style="border:1px solid #ddd;padding:4px;text-align:center">26.4</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">1.15%</td><td style="border:1px solid #ddd;padding:4px;text-align:center">417ms</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">‚úÖ PASS</td><td style="border:1px solid #ddd;padding:4px;text-align:center">√ìptimo</td></tr>
                    <tr><td style="border:1px solid #ddd;padding:4px;text-align:center">36</td><td style="border:1px solid #ddd;padding:4px;text-align:center">39.1</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">0.96%</td><td style="border:1px solid #ddd;padding:4px;text-align:center">406ms</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#2ecc71">‚úÖ PASS</td><td style="border:1px solid #ddd;padding:4px;text-align:center">M√°ximo</td></tr>
                    <tr><td style="border:1px solid #ddd;padding:4px;text-align:center">48</td><td style="border:1px solid #ddd;padding:4px;text-align:center">35.4</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#e74c3c">13.60%</td><td style="border:1px solid #ddd;padding:4px;text-align:center">845ms</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#e74c3c">‚ùå FAIL</td><td style="border:1px solid #ddd;padding:4px;text-align:center">Saturaci√≥n</td></tr>
                    <tr><td style="border:1px solid #ddd;padding:4px;text-align:center">60</td><td style="border:1px solid #ddd;padding:4px;text-align:center">32.4</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#c62828">30.50%</td><td style="border:1px solid #ddd;padding:4px;text-align:center">1340ms</td><td style="border:1px solid #ddd;padding:4px;text-align:center;color:#c62828">‚ùå FAIL</td><td style="border:1px solid #ddd;padding:4px;text-align:center">Colapso</td></tr>
                </tbody>
            </table>
            <br>
            <h4>üéØ Definici√≥n Final de Capacidades:</h4>
            <ul>
                <li><strong>Capacidad √ìptima Operativa:</strong> 36 usuarios concurrentes m√°ximo</li>
                <li><strong>Zona de Seguridad:</strong> 12-30 usuarios concurrentes</li>
                <li><strong>L√≠mite Absoluto:</strong> No superar 40 usuarios bajo ninguna circunstancia</li>
                <li><strong>Punto de Quiebre:</strong> Entre 36-48 usuarios (precipicio de rendimiento)</li>
                <li><strong>Escalamiento Requerido:</strong> SQL Server necesita 4x m√°s recursos de CPU</li>
            </ul>
        </div>
    </div>

<script>
window.addEventListener('load',function(){
    if(typeof Chart==='undefined')return;
    
    // Datos basados en los gr√°ficos de Performance Monitor para 60 usuarios (10 minutos de prueba)
    const t=['5:47:45','5:49:00','5:50:30','5:52:00','5:53:30','5:55:00','5:56:30','5:57:59'];
    
    // IIS Server 1 (BBVAMX-UATIIS1) - basado en imagen 1
    const s1={cpu:[12,18,24,16,19,23,26,15],mem:[18,0,0,0,0,0,0,0],dc:[1,11,4,8,7,6,13,21],dn:[29,19,16,22,17,24,26,18]};
    
    // IIS Server 2 (BBVAMX-UATIIS2) - basado en imagen 2  
    const s2={cpu:[16,15,6,20,17,19,25,16],mem:[18,0,0,0,0,0,0,0],dc:[0,7,20,8,13,24,11,14],dn:[39,15,18,31,16,22,18,23]};
    
    // SQL Server (BBVAMX-UATSQL1) - basado en imagen 3
    const sql={cpu:[87,78,91,95,84,91,93,98],mem:[22,0,0,0,0,0,0,0],dc:[2,15,53,18,16,10,14,16],dg:[35,32,75,96,86,92,95,99]};
    
    const opt={responsive:true,maintainAspectRatio:true,aspectRatio:2,plugins:{legend:{display:true,position:'top',labels:{font:{size:9},boxWidth:10,padding:8}}},scales:{y:{beginAtZero:true,max:100,title:{display:true,text:'Uso (%)',font:{size:10}},ticks:{font:{size:9}}},x:{title:{display:true,text:'Tiempo',font:{size:10}},ticks:{font:{size:9}}}}};
    
    function cc(id,cfg){try{const el=document.getElementById(id);if(!el)return null;return new Chart(el,cfg);}catch(e){return null;}}
    
    cc('pieChart',{type:'pie',data:{labels:['PASS (69.50%)','FAIL (30.50%)'],datasets:[{data:[69.50,30.50],backgroundColor:['#ff9800','#c62828'],borderWidth:2,borderColor:'#fff'}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:true,position:'bottom',labels:{font:{size:8},boxWidth:8,padding:4,usePointStyle:true}}}}});
    
    cc('s1cpu',{type:'line',data:{labels:t,datasets:[{label:'CPU',data:s1.cpu,borderColor:'#f9ca24',backgroundColor:'rgba(249,202,36,0.1)',tension:0.4,borderWidth:2},{label:'Memoria',data:s1.mem,borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.1)',tension:0.4,borderWidth:2}]},options:opt});
    
    cc('s2cpu',{type:'line',data:{labels:t,datasets:[{label:'CPU',data:s2.cpu,borderColor:'#f9ca24',backgroundColor:'rgba(249,202,36,0.1)',tension:0.4,borderWidth:2},{label:'Memoria',data:s2.mem,borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.1)',tension:0.4,borderWidth:2}]},options:opt});
    
    cc('sqlcpu',{type:'line',data:{labels:t,datasets:[{label:'CPU',data:sql.cpu,borderColor:'#f9ca24',backgroundColor:'rgba(249,202,36,0.1)',tension:0.4,borderWidth:2},{label:'Memoria',data:sql.mem,borderColor:'#ff6b6b',backgroundColor:'rgba(255,107,107,0.1)',tension:0.4,borderWidth:2}]},options:opt});
    
    cc('s1disk',{type:'line',data:{labels:t,datasets:[{label:'Disco C:',data:s1.dc,borderColor:'#4ecdc4',backgroundColor:'rgba(78,205,196,0.1)',tension:0.4,borderWidth:2},{label:'Disco N:',data:s1.dn,borderColor:'#9b59b6',backgroundColor:'rgba(155,89,182,0.1)',tension:0.4,borderWidth:2}]},options:opt});
    
    cc('s2disk',{type:'line',data:{labels:t,datasets:[{label:'Disco C:',data:s2.dc,borderColor:'#4ecdc4',backgroundColor:'
